name: Deploy to vm
# Only trigger, when the build workflow succeeded
on:
  workflow_run:
    workflows: [Build]
    types:
      - completed
jobs:
  deploy:
      runs-on: ubuntu-latest
      steps:
        - name: Download a single artifact
          uses: actions/download-artifact@v3
          with:
            name: built-ukelele-jar
        - name: Stopping ukelele on server
          uses: appleboy/ssh-action@master
          with:
            host: ${{ secrets.HOST }}
            username: ${{ secrets.USERNAME }}
            key: ${{ secrets.KEY }}
            script: sudo sytemctl stop ukelele

        - name: Copy jar file
          uses: appleboy/scp-action@master
          with:
            host: ${{ secrets.HOST }}
            username: ${{ secrets.USERNAME }}
            key: ${{ secrets.KEY }}
            source: "ukelele.jar"
            target: "/home/ajahueym/Gits/ukelele/"

        - name: Restarting ukelele on server
          uses: appleboy/ssh-action@master
          with:
            host: ${{ secrets.HOST }}
            username: ${{ secrets.USERNAME }}
            key: ${{ secrets.KEY }}
            script: sudo sytemctl start ukelele